---
layout:		post
title:		"「雅礼集训 2017 Day1」字符串"
date:		2019-01-15
author:		Dispwnl
header-img:
catalog:	false
tags:
    - 后缀自动机
    - 莫队
    - 倍增

---

## [题目](https://loj.ac/problem/6031)

### 题目描述

令 $s$ 与 $w$ 为两字符串，定义：

1. $w[l, r]$ 表示字符串 $w$ 在区间 $[l, r]$ 中的子串；
2. $w$ 在 $s$ 中出现的频率定义为$w$ 在 $s$ 中出现的次数；
3. $f(s, w, l, r)$ 表示 $w[l, r]$ 在 $s$ 中出现的频率。

比如 $f(\texttt{ababa}, \texttt{aba}, 1, 3) = 2$。

现在给定串 $s$，$m$ 个区间 $[l, r]$ 和长度 $k$，你要回答 $q$ 个询问，每个询问给你一个长度为 $k$ 的字符串 $w$ 和两个整数 $a, b$，求：$\sum\limits_{i = a} ^ b f(s, w, l_i, r_i)$


### 输入格式

第一行四个整数 $n, m, q, k$，$n$ 表示 $s$ 的长度。
接下来一行一个长为 $s$ 的字符串 $s$。
接下来 $m$ 行，每行两个整数表示 $l_i, r_i$。
接下来 $q$ 行，每行一个字符串 $w$，两个整数 $a, b$。

### 输出格式

对于每个询问一行，输出答案。

### 样例

#### 样例输入

```plain
8 5 3 3
abacdaba
0 2
1 2
0 0
2 2
1 2
dab 1 4
bac 2 3
eeb 1 3
```

#### 样例输出

```plain
7
3
2
```

### 数据范围与提示

对于 $10\%​$ 的数据，$n, m, k, q \leq 10​$；
对于 $30\%​$ 的数据，满足 $n, m, k, q \leq 10 ^ 2​$；
对于 $50\%​$ 的数据，满足 $n, m, k, q \leq 10 ^ 4​$；
对于 $100\%​$ 的数据，满足 $n, m, k, q \leq 10 ^ 5, \sum w \leq 10 ^ 5​$，字符串由小写英文字母构成。

### 题解

真·数据分治

发现$\sum w_i=k\times q\le 10^5$，所以分$k$的大小讨论

如果$k$比较小，小到可以支持$O(k^2)$的复杂度，那么可以维护$w$上的区间$[a,b]$在询问$[l,r]$中出现的次数$t$，这样就可以枚举$w$的每一段子串，匹配到状态$A$的时候，这段子串答案就是$t\times right_A$，求和即可，复杂度$O(n\sqrt n \times k^2)$

如果$k$比较大，说明$q$比较小，匹配字符串的时候如果这个位置是某个询问的右端点，所以ta的祖先中最小的大于等于询问区间长度的$len$对应的状态的$right$集合大小就是这个询问的答案，这个可以倍增处理，复杂度$O(q\times (logk+k)$

~~为什么不能分成两道题出呢……~~

### 代码

![](/img/qaq/咕咕咕.jpg)

